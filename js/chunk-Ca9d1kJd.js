import{E as t,M as e,Q as a,V as n,O as c,a as s}from"./chunk-P8XhL4_m.js";class o extends s{constructor(t){super(),this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",(()=>{this.traverse((t=>{t instanceof o&&t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,e){return s.prototype.copy.call(this,t,e),this.element=t.element.cloneNode(!0),this}}class i extends o{constructor(t,a=1){super(t),this.spriteRatio=a,this.spriteMatrixWorld=(new e).copy(this.matrixWorld)}}class r extends t{zOrder(t){const{cache:e}=this,a=[];t.traverse((t=>{const n=t;e.objects.has(n)&&a.push({object:n,data:e.objects.get(n)})}));const n=a.sort(((t,e)=>t.data.distanceToCameraSquared-e.data.distanceToCameraSquared)),c=n.length;n.forEach(((t,e)=>{const{object:a}=t;a.element.style.zIndex="".concat(c-e)}))}constructor(){super(),this._width=0,this._height=0,this._widthHalf=0,this._heightHalf=0,this.matrix=new e,this._spriteQuat=new a,this._objectQuat=new a,this.cache={camera:{fov:0,style:""},objects:new WeakMap},this.epsilon=t=>Math.abs(t)<1e-10?0:t,this.getDistanceToSquared=function(){const t=new n,e=new n;return function(a,n){return t.setFromMatrixPosition(a.matrixWorld),e.setFromMatrixPosition(n.matrixWorld),t.distanceToSquared(e)}}(),this.getCameraCSSMatrix=(t,e,a)=>{const{epsilon:n}=this,{elements:s}=t,o="matrix3d(".concat(n(s[0]),",").concat(n(-s[1]),",").concat(n(s[2]),",").concat(n(s[3]),",").concat(n(s[4]),",").concat(n(-s[5]),",").concat(n(s[6]),",").concat(n(s[7]),",").concat(n(s[8]),",").concat(n(-s[9]),",").concat(n(s[10]),",").concat(n(s[11]),",").concat(n(s[12]),",").concat(n(-s[13]),",").concat(n(s[14]),",").concat(n(s[15]),")");if(e instanceof c){const t=-(e.right+e.left)/2,c=(e.top+e.bottom)/2;return"scale(".concat(a,")translate(").concat(n(t),"px,").concat(n(c),"px)").concat(o)}return"translateZ(".concat(a,"px)").concat(o)},this.getObjectCSSMatrix=(t,e)=>{const{epsilon:a}=this,{elements:n}=t,c="matrix3d(".concat(a(n[0]),",").concat(a(n[1]),",").concat(a(n[2]),",").concat(a(n[3]),",").concat(a(-n[4]),",").concat(a(-n[5]),",").concat(a(-n[6]),",").concat(a(-n[7]),",").concat(a(n[8]),",").concat(a(n[9]),",").concat(a(n[10]),",").concat(a(n[11]),",").concat(a(n[12]),",").concat(a(n[13]),",").concat(a(n[14]),",").concat(a(n[15]),")");return this.isIE?"translate(-50%,-50%)translate(".concat(this._widthHalf,"px,").concat(this._heightHalf,"px)").concat(e).concat(c):"translate(-50%,-50%)".concat(c)},this.renderObject=(t,e,a,n)=>{const{matrix:c,getObjectCSSMatrix:s,cache:r,cameraElement:l,renderObject:h,isIE:d,getDistanceToSquared:m}=this;if(t instanceof o){let o;t.onBeforeRender(this,e,a),t instanceof i?(c.copy(a.matrixWorldInverse),c.transpose(),this._spriteQuat.setFromRotationMatrix(c),this._objectQuat.setFromRotationMatrix(t.matrixWorld),this._objectQuat.slerp(this._spriteQuat,t.spriteRatio),c.makeRotationFromQuaternion(this._objectQuat),c.copyPosition(t.matrixWorld),c.scale(t.scale),c.elements[3]=0,c.elements[7]=0,c.elements[11]=0,c.elements[15]=1,t.spriteMatrixWorld.copy(c),o=s(c,n)):o=s(t.matrixWorld,n);const{element:h}=t,p=r.objects.get(t);if(void 0===p||p.style!==o){h.style.transform=o;const e={style:o};r.objects.set(t,e),d&&(e.distanceToCameraSquared=m(a,t))}h.style.display=t.visible?"":"none",h.parentNode!==l&&l.appendChild(h),t.onAfterRender(this,e,a)}for(let o=0,i=t.children.length;o<i;o++)h(t.children[o],e,a,n)};const t=document.createElement("div");this.domElement=t,t.style.overflow="hidden";const s=document.createElement("div");this.cameraElement=s,s.style.transformStyle="preserve-3d",t.appendChild(s),this.isIE=/Trident/i.test(navigator.userAgent)}setClearColor(){}getSize(){return{width:this._width,height:this._height}}setSize(t,e){this._width=t,this._height=e,this._widthHalf=this._width/2,this._heightHalf=this._height/2,this.domElement.style.width="".concat(t,"px"),this.domElement.style.height="".concat(e,"px"),this.cameraElement.style.width="".concat(t,"px"),this.cameraElement.style.height="".concat(e,"px")}render(t,e){const{_heightHalf:a,_widthHalf:n,isIE:c,cameraElement:s,cache:o,domElement:i,getCameraCSSMatrix:r,zOrder:l,renderObject:h}=this,d=e.projectionMatrix.elements[5]*a;o.camera.fov!==d&&(i.style.perspective="".concat(d,"px"),o.camera.fov=d),(t.matrixAutoUpdate&&!0===t.matrixAutoUpdate||!0===t.autoUpdate)&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld();const m=r(e.matrixWorldInverse,e,d),p="".concat(m,"translate(").concat(n,"px,").concat(a,"px)");o.camera.style===p||c||(s.style.transform=p,o.camera.style=p),h(t,t,e,m),c&&l(t)}}export{r as C,o as a};
